# CONFIGURATION TELNYX MEDIA STREAM BIDIRECTIONNEL

## ‚úÖ Param√®tres requis pour streaming_start

```json
{
  "stream_url": "wss://api-calls.harx.ai/audio-stream",
  "stream_track": "both_tracks",
  "enable_dialogflow": false
}
```

## üìã Valeurs possibles pour stream_track

- `inbound_track` : Audio du receiver ‚Üí Vous (vous ENTENDEZ seulement)
- `outbound_track` : Vous ‚Üí receiver (le receiver ENTEND seulement)
- `both_tracks` : Audio bidirectionnel (REQUIS pour votre cas)

## ‚ö†Ô∏è IMPORTANT

Si vous ne recevez PAS de messages "media" de Telnyx apr√®s `streaming.started`,
v√©rifiez :

1. **Votre configuration Telnyx Portal** :
   - Connection ‚Üí Settings ‚Üí Enable Media Streaming
   - V√©rifier que l'URL WebSocket est accessible publiquement

2. **Votre certificat SSL** :
   - Telnyx requiert WSS (WebSocket Secure)
   - V√©rifiez que wss://api-calls.harx.ai/audio-stream est accessible

3. **Le receiver doit PARLER** :
   - Telnyx n'envoie des packets que quand il y a de l'audio
   - Si silence complet ‚Üí aucun packet "media"

## üß™ Test rapide

```bash
# Tester l'accessibilit√© WebSocket
wscat -c wss://api-calls.harx.ai/audio-stream

# Devrait se connecter et recevoir :
# {"version":"1.0.0","event":"connected"}
```

## üìä Messages attendus de Telnyx

### 1. Connexion
```json
{"version":"1.0.0","event":"connected"}
```

### 2. D√©marrage stream
```json
{
  "event": "start",
  "start": {
    "call_control_id": "v3:xxx",
    "media_format": {
      "encoding": "PCMA",
      "sample_rate": 8000,
      "channels": 1
    }
  }
}
```

### 3. Audio inbound (du receiver)
```json
{
  "event": "media",
  "media": {
    "payload": "base64_encoded_audio",
    "track": "inbound",
    "timestamp": "12345"
  }
}
```

### 4. Audio outbound (vers receiver - optionnel)
```json
{
  "event": "media",
  "media": {
    "payload": "base64_encoded_audio",
    "track": "outbound",
    "timestamp": "12345"
  }
}
```

## üîß Debugging

Si aucun message "media" n'arrive :

1. V√©rifier les logs backend pour :
   ```
   üéß PREMIER MESSAGE MEDIA RE√áU DE TELNYX !
   ```

2. Si absent, le probl√®me est c√¥t√© Telnyx :
   - Configuration du streaming incorrect
   - URL WebSocket non accessible
   - Certificat SSL invalide

3. Si pr√©sent mais rien ne joue :
   - V√©rifier les logs frontend (F12)
   - V√©rifier que audioContext est cr√©√©
   - V√©rifier playAudioChunk()

